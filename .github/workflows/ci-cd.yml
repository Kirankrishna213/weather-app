name: Full CI Logs with Tests & Security

on:
  push:
    branches:
      - main

jobs:
  build-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
          cache: pip

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest black flake8 pip-audit safety

      # -----------------------------
      # Code Formatting
      # -----------------------------
      - name: Run Black (shows full diff but does NOT fail)
        run: black --diff .

      - name: Run flake8 (shows logs but does NOT fail)
        run: flake8 . || true

      # -----------------------------
      # Tests (pytest)
      # -----------------------------
      - name: Run pytest (full verbose output)
        run: pytest -vv

      # -----------------------------
      # Security Scans
      # -----------------------------
      - name: Run pip-audit (show all CVEs)
        run: pip-audit || true

      - name: Run OWASP Safety (show all CVEs)
        run: safety check || true
